<!-- gui/static/index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <meta charset="utf-8" />
  <title>BEL PDIC R&WS ‚Äî Instrument Automation For Digital TRC</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo-wrapper">
        <img src="/static/logo.png" class="logo-img" alt="BEL Logo">
        <div class="signature">SHIVALING</div>
      </div>
      <div class="title">PDIC CoE R&amp;WS ‚Äî Instrument Automation Dashboard For Digital TRC</div>
    </div>
    <div class="actions">
      <!-- <button id="btn-discover" class="btn small" onclick="doDiscover()">Discover</button> -->
      <button id="btn-openall" class="btn small" onclick="openAll()">Open All</button>
      <button id="btn-closeall" class="btn small" onclick="closeAll()">Close All</button>
      <button id="btn-setall" class="btn small" onclick="setAll()">Set All</button>
      <button id="btn-logout" class="btn small">Logout</button>  <!-- NEW -->
    </div>
  </header>

  <main class="workspace">
    <nav class="sidebar">
      <div class="card">
        <h3>Instruments</h3>
        <div id="instruments_list">
          <div class="inst-row"><strong>psu</strong>: <span id="psu_idn">(not attached)</span></div>
          <div class="inst-row"><strong>psu2</strong>: <span id="psu2_idn">(not attached)</span></div>  <!-- new -->
          <div class="inst-row"><strong>gen</strong>: <span id="gen_idn">(not attached)</span></div>
          <div class="inst-row"><strong>sa</strong>: <span id="sa_idn">(not attached)</span></div>
          <hr/>
          <label>Resource (discover then paste)</label>
          <input id="resource_input" placeholder="USB0::0x....::INSTR" />
          <div style="display:flex;gap:6px;margin-top:8px;">
            <button class="btn" onclick="attachManual('psu')">Attach PSU</button>
            <button class="btn" onclick="attachManual('psu2')">Attach PSU 2</button>  <!-- new -->
            <button class="btn" onclick="attachManual('gen')">Attach Gen</button>
            <button class="btn" onclick="attachManual('sa')">Attach SA</button>
          </div>
          <div style="margin-top:8px;">
            <button class="btn outline" onclick="attachAuto('psu')">Auto-attach PSU</button>
            <button class="btn outline" onclick="attachAuto('psu2')">Auto-attach PSU 2</button>  <!-- new -->
            <button class="btn outline" onclick="attachAuto('gen')">Auto-attach Gen</button>
            <button class="btn outline" onclick="attachAuto('sa')">Auto-attach SA</button>
          </div>
        </div>
      </div>
      <div class="card">
        <h3>Discovery</h3>
        <button class="btn" onclick="doDiscover()">Discover VISA</button>
        <ul id="resources_list" class="resource-list"></ul>
      </div>
    </nav>

    <section class="panelgrid">
      <!-- PSU panel -->
      <div class="panel card">
        <h3>Power Supply (N8739A)</h3>
        <div class="formrow">
          <label>Voltage (V)</label>
          <input id="psu_voltage" value = "12.0" type="number" step="0.01" />
        </div>
        <div class="formrow">
          <label>Current (A)</label>
          <input id="psu_current" value = "12.0"  type="number" step="0.01" />
        </div>
        <div class="formrow actions-row">
          <button class="btn" onclick="setPSU()">Set</button>
          <button class="btn" onclick="psuOutput('psu', 'on')">Output ON</button>
          <button class="btn" onclick="psuOutput('psu', 'off')">Output OFF</button>
        </div>
        <div class="info" id="psu_info">Voltage: - | Current: -</div>
      </div>

      <!-- Second PSU panel -->
      <div class="panel card">
        <h3>Power Supply 2 (N8739A)</h3>
        <div class="formrow">
          <label>Voltage (V)</label>
          <input id="psu2_voltage" value = "12.0" type="number" step="0.01" />
        </div>
        <div class="formrow">
          <label>Current (A)</label>
          <input id="psu2_current" value = "24.0" type="number" step="0.01" />
        </div>
        <div class="formrow actions-row">
          <button class="btn" onclick="setPSU('psu2')">Set</button>
          <button class="btn" onclick="psuOutput('psu2', 'on')">Output ON</button>
          <button class="btn" onclick="psuOutput('psu2', 'off')">Output OFF</button>
        </div>
        <div class="info" id="psu2_info">Voltage: - | Current: -</div>
      </div>

      <!-- Generator panel -->
      <div class="panel card">
        <h3>Signal Generator (SMB100A)</h3>
        <div class="formrow">
          <label>Frequency (MHz)</label>
          <input id="gen_freq" value = "3000" type="number" step="1" />
        </div>
        <div class="formrow">
          <label>Power (dBm)</label>
          <input id="gen_power" value = "0" type="number" step="0.1" />
        </div>
        <div class="formrow actions-row">
          <button class="btn" onclick="setGen()">Set</button>
          <button class="btn" onclick="genRF('on')">RF ON</button>
          <button class="btn" onclick="genRF('off')">RF OFF</button>
        </div>
        <div class="info" id="gen_info">Freq: - | Power: -</div>
      </div>

      <!-- Analyzer panel -->
      <div class="panel card large">
        <h3>Signal Analyzer (N9030B)</h3>
        <div class="formrow">
          <label>Center (MHz)</label>
          <input id="sa_center" value = "3000" type="number" step="1" />
        </div>
        <div class="formrow">
          <label>Span (MHz)</label>
          <input id="sa_span" value = "1000" type="number" step="1" />
        </div>
        <div class="formrow">
          <label>RBW (kHz)</label>
          <input id="sa_rbw" value = "100" type="number" step="1" />
        </div>
        <div class="formrow actions-row">
          <button class="btn" onclick="setSA()">Set</button>
          <button class="btn" onclick="readMarker()">Read Marker</button>
          <button class="btn" onclick="getScreenshot()">Screenshot</button>
          <button class="btn" onclick="saTraceClear()">Clear Trace</button>
          <button class="btn" onclick="saTraceMax()">Set Max Hold</button>
          <button class="btn" onclick="getTrace()">Fetch Trace</button>
          <button class="btn" onclick="saAmp('up')">Ref +</button>
          <button class="btn" onclick="saAmp('down')">Ref -</button>
        </div>
        <div class="analyzer-marker">
          <label>Marker:</label>
          <span id="sa_marker_value">‚Äî</span>
        </div>
        <div class="screenshot-area">
          <img id="sa_screen" style="max-width:100%; display:none; border-radius:6px; margin-top:8px;">
        </div>
        
      </div>



      <!-- FPGA panel -->
      <div class="panel card">
        <h3>FPGA Programming</h3>
        <div class="formrow actions-row">
          <button class="btn big" onclick="programFPGA()">Program FPGA</button>
        </div>
        <div class="info" id="fpga_status">Status: idle</div>
        <!-- Progress bar -->
        <div class="formrow">
          <progress id="fpga_progress" value="0" max="100" style="width:100%"></progress>
        </div>
      </div>

      <!-- RS-422 panel -->
      <div class="panel card">
        <h3>RS-422 Communication</h3>
        <div class="formrow">
          <label>COM Port</label>
          <input id="rs422_port" placeholder="COM3 or /dev/ttyUSB0" value="COM">
        </div>
        <div class="formrow">
          <label>9-byte Packet (hex, space-separated)</label>
          <input id="rs422_packet" placeholder="AA BB CC 00 01 02 03 04 05" value="AA BB CC 00 01 02 03 04 05">
        </div>
        <div class="formrow actions-row">
          <button class="btn" onclick="sendRS422()">Send</button>
        </div>
        <div class="info">
          <strong>Response:</strong>
          <pre id="rs422_response">‚Äî</pre>
        </div>
      </div>
      
      <!-- 10G UDP panel -->
      <div class="panel card">
        <h3>10G UDP Sender</h3>

        <div class="formrow">
          <label>Source IP:Port</label>
          <input id="udp_src" placeholder="172.193.161.135:6055" value="192.168.1.5:5005"/>
        </div>

        <div class="formrow">
          <label>Destination IP:Port</label>
          <input id="udp_dst" placeholder="192.168.1.10:5005" value="192.168.1.10:6005"/>
        </div>

        <div class="formrow">
          <label>Spot</label>
          <select id="dtrc_spot" style="width:220px">
            <option value="00">00 ‚Äî Spot 0</option>
            <option value="01">01 ‚Äî Spot 1</option>
            <option value="02">02 ‚Äî Spot 2</option>
            <option value="03">03 ‚Äî Spot 3</option>
            <option value="04">04 ‚Äî Spot 4</option>
            <option value="05">05 ‚Äî Spot 5</option>
          </select>
        </div>

        <div class="formrow">
          <label>Pulse Width</label>
          <select id="dtrc_pulse" style="width:220px">
            <option value="00 01">00 01 ‚Äî 1 (decimal)</option>
            <option value="00 02">00 02 ‚Äî 2</option>
            <option value="00 04">00 04 ‚Äî 4</option>
            <option value="00 08">00 08 ‚Äî 8</option>
            <option value="00 10">00 10 ‚Äî 16</option>
            <option value="00 20">00 20 ‚Äî 32</option>
            <option value="00 40">00 40 ‚Äî 64</option>
            <option value="00 80">00 80 ‚Äî 128</option>
          </select>
        </div>

        <div class="formrow">
          <label>PRT</label>
          <select id="dtrc_prt" style="width:220px">
            <option value="0A AB 00 00">0A AB 00 00 ‚Äî 437,250 (decimal)</option>
            <option value="14 AB 00 00">14 AB 00 00 ‚Äî 1,342,850</option>
            <option value="1E AB 00 00">1E AB 00 00 ‚Äî 2,248,450</option>
            <option value="28 AB 00 00">28 AB 00 00 ‚Äî 3,154,050</option>
            <option value="32 AB 00 00">32 AB 00 00 ‚Äî 4,059,650</option>
            <option value="3C AB 00 00">3C AB 00 00 ‚Äî 4,965,250</option>
            <option value="46 AB 00 00">46 AB 00 00 ‚Äî 5,870,850</option>
            <option value="50 AB 00 00">50 AB 00 00 ‚Äî 6,776,450</option>
          </select>
        </div>

        <div class="formrow actions-row">
          <button class="btn" onclick="sendUDP()">Send</button>
        </div>

        <div class="info">
          <strong>Response:</strong>
          <pre id="udp_response">‚Äî</pre>
        </div>
      </div>

      <!-- Automation panel -->
      <div class="panel card">
        <h3>Automation</h3>

        <!-- DTRC Input Controls -->
        <div class="formrow">
          <label>DTRC Board No</label>
          <select id="dtrc_board" type="number" value="1" min="1" style="width:80px" />
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
          </select>

          <label>Channel No</label>
          <select id="dtrc_channel" type="number" value="1" min="1" max="16" style="width:80px" />
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="1">9</option>
            <option value="2">10</option>
            <option value="3">11</option>
            <option value="4">12</option>
            <option value="5">13</option>
            <option value="6">14</option>
            <option value="7">15</option>
            <option value="8">16</option>
          </select>
        </div>

        <!-- Pulse Width and PRT dropdowns -->
        <div class="formrow">
          <label>Pulse Width</label>
          <select id="dtrc_pulse" style="width:220px">
            <option value="00 01">00 01 ‚Äî 1 (decimal)</option>
            <option value="00 02">00 02 ‚Äî 2</option>
            <option value="00 04">00 04 ‚Äî 4</option>
            <option value="00 08">00 08 ‚Äî 8</option>
            <option value="00 10">00 10 ‚Äî 16</option>
            <option value="00 20">00 20 ‚Äî 32</option>
            <option value="00 40">00 40 ‚Äî 64</option>
            <option value="00 80">00 80 ‚Äî 128</option>
          </select>

          <label>PRT</label>
          <select id="dtrc_prt" style="width:260px">
            <option value="0A AB 00 00">0A AB 00 00 ‚Äî 437,250 (decimal)</option>
            <option value="14 AB 00 00">14 AB 00 00 ‚Äî 1,342,850</option>
            <option value="1E AB 00 00">1E AB 00 00 ‚Äî 2,248,450</option>
            <option value="28 AB 00 00">28 AB 00 00 ‚Äî 3,154,050</option>
            <option value="32 AB 00 00">32 AB 00 00 ‚Äî 4,059,650</option>
            <option value="3C AB 00 00">3C AB 00 00 ‚Äî 4,965,250</option>
            <option value="46 AB 00 00">46 AB 00 00 ‚Äî 5,870,850</option>
            <option value="50 AB 00 00">50 AB 00 00 ‚Äî 6,776,450</option>
          </select>
        </div>

        <div class="formrow actions-row" style="margin-top:8px;">
          <button class="btn big" onclick="runAutomation()">‚ñ∂Ô∏è Run Example Sequence</button>
          <button class="btn big outline" onclick="downloadLatestReport()">üì• Download Last Report</button>
        </div>

        <small style="display:block;margin-top:8px;">
          Runs automation for selected DTRC board & channel.
        </small>

        <hr style="margin:10px 0;" />

        <!-- Automation runtime info -->
        <div style="margin-top:12px; padding:12px; border-radius:6px; background:#0f1724; color:#fff;">
          <div><strong>Automation Status:</strong></div>
          <div id="automation_status" style="margin-top:6px">Idle</div>
          <div id="automation_metrics" style="margin-top:8px; font-size:0.95em; color:#cbd5e1;">‚Äî</div>
        </div>
      </div>



      <!--
      <div class="panel card">
        <h3>Automation</h3>
        
        <div class="formrow">
          <label>DTRC Board No</label>
          <input id="dtrc_board" type="number" value="1" min="1" style="width:80px" />

          <label>Channel No</label>
          <input id="dtrc_channel" type="number" value="1" min="1" max="16" style="width:80px" />

          <label>Pulse Width (2 bytes hex)</label>
          <input id="dtrc_pulse" list="payload" type="text" placeholder="00 01" value="00 01" style="width:140px" />
          <datalist id="payload">
            <option value="00 01">option 1</option>
            <option value="01 01">option 2</option>
            <option value="01 01">option 3</option>
          </datalist>


          <label>PRT (4 bytes hex)</label>
          <input id="dtrc_prt" list="payloads" type="text" placeholder="0A AB 00 00" value="0A AB 00 00" style="width:180px" />
          <datalist id="payloads">
            <option value="00 01 00 00">option 1</option>
            <option value="01 01 00 00">option 2</option>
            <option value="01 01 00 00">option 3</option>
          </datalist>
        </div>

        <div>
          <button class="btn big" onclick="runAutomation()">‚ñ∂Ô∏è Run Example Sequence</button>
          <button class="btn big outline" onclick="downloadLatestReport()">Download Last Report</button>
        </div>

        <div style="margin-top:8px;">
          <small>Example sequence: PSU ‚Üí GEN ‚Üí SA measurement (safe defaults applied).</small>
        </div>

        <hr style="margin:10px 0;" />

        
        <div style="margin-top:12px; padding:12px; border-radius:6px; background:#0f1724; color:#fff;">
          <div><strong>Automation Status:</strong></div>
          <div id="automation_status" style="margin-top:6px">Idle</div>
          <div id="automation_metrics" style="margin-top:8px; font-size:0.95em; color:#cbd5e1;">‚Äî</div>
        </div>
      </div> -->

    </section>
  </main>

  <footer class="statusbar">
    <div class="status-left">Status Log</div>
    <div class="status-right">
      <button class="btn tiny" onclick="clearLog()">Clear</button>
    </div>
    <pre id="status" class="statusbox">Ready...</pre>
  </footer>

  <script src="/static/script.js"></script>
</body>
</html>
